<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>
	<title>Portal 2 Verifier Leaderboard</title>
	<link rel='icon' sizes='192x192' href='../p2VerifierLeaderboard/purplecup.png'>
</head>

<body style="background-color:black">
	<style type="text/css">
		@font-face {
    font-family: 'verdana';
    src: url('Verdana.woff2') format('woff2'),
         url('Verdana.woff') format('woff');
    font-weight: normal;
    font-style: normal;

}
		body{
			background-color: rgba(255,255,255,0);
		}
		#table{
			font-size: 500%;
			/*font-family: Sans-serif;*/
			font-family: verdana;
			background-color: #545454;
			color: #6a8ed2;
			/*color: #ffffff;*/
			table-layout: auto;
			width: 100%;
			border-collapse: collapse;
		}
		td{
			border: 2px solid #99aab5;
			/*border: 2px solid #2c2f33;*/
			padding: 10px;
		}
	</style>
	<div id="board">
		<table id="table">
		</table>
	</div>
	<script type="text/javascript">
	if (navigator.serviceWorker) {
		navigator.serviceWorker.register('/p2VerifierLeaderboard/sw.js', {scope: '/p2VerifierLeaderboard/'})
	}
	function swap(json) {
		var ret = {};
		for (var key in json) {
			ret[json[key]] = key;
		}
		return ret;
	}
	function sortObject(obj) {
		return Object.keys(obj)
			.sort().reduce((a, v) => {
				a[v] = obj[v];
				return a;
			}, {});
	}
	function reverseObject(object) {
        var newObject = {};
        var keys = [];

        for (var key in object) {
            keys.push(key);
        }

        for (var i = keys.length - 1; i >= 0; i--) {
          var value = object[keys[i]];
          newObject[keys[i]]= value;
        }       

        return newObject;
      }
	let xhr = new XMLHttpRequest();
	xhr.setRequestHeader('Cache-Control', 'max-age=43200');
	xhr.open("GET", "https://www.speedrun.com/api/v1/games/om1mw4d2", true);
	xhr.send();
	moderators = []
	runsVerified = []
	database = JSON.parse(xhr.responseText);
	for (key in database["data"]["moderators"]) {
		moderators.push(key)
	}
	let xhr2 = new XMLHttpRequest();
	xhr2.setRequestHeader('Cache-Control', 'max-age=43200');
	for (var i = moderators.length - 1; i >= 0; i--) {
		xhr2.open("GET", "https://www.speedrun.com/api/v1/runs?game=om1mw4d2&max=200&examiner=" + moderators[i], true);
		xhr2.send();
		runs = JSON.parse(xhr2.responseText)
		runsVerifiedNumberP2 = runs.pagination.size
		do {
			if (runs.pagination.size == 200) {
				xhr2.open("GET", "https://www.speedrun.com/api/v1/runs?game=om1mw4d2&max=200&examiner=" + moderators[i] + "&offset=" + runsVerifiedNumberP2, true);
				xhr2.send();
				runs = JSON.parse(xhr2.responseText)
				runsVerifiedNumberP2 += runs.pagination.size
			}

		} while (runs.pagination.size == 200)

		xhr2.open("GET", "https://www.speedrun.com/api/v1/runs?game=3dx23z51&max=200&examiner=" + moderators[i], true);
		xhr2.send();
		runs = JSON.parse(xhr2.responseText)
		runsVerifiedNumberP2CE = runs.pagination.size
		do {
			if (runs.pagination.size == 200) {
				xhr2.open("GET", "https://www.speedrun.com/api/v1/runs?game=3dx23z51&max=200&examiner=" + moderators[i] + "&offset=" + runsVerifiedNumberP2CE, true);
				xhr2.send();
				runs = JSON.parse(xhr2.responseText)
				runsVerifiedNumberP2CE += runs.pagination.size
			}
		} while (runs.pagination.size == 200)

		runsVerifiedNumber = runsVerifiedNumberP2 + runsVerifiedNumberP2CE

		runsVerified.push(runsVerifiedNumber)
	}
	runsVerified = runsVerified.reverse()
	var result = {};
	moderators.forEach((key, i) => result[key] = runsVerified[i]);

	result = swap(result)
	result = sortObject(result)
	result = swap(result)
	result = reverseObject(result)

	//	_Smiley king
	console.log(result);
	let xhr3 = new XMLHttpRequest();
	xhr3.setRequestHeader('Cache-Control', 'max-age=43200');
	var output = ""
	var place = 0
	for (key in result) {
		place++
		xhr3.open("GET", "https://www.speedrun.com/api/v1/users/" + key, true);
		xhr3.send();
		ModName = JSON.parse(xhr3.responseText)
		name2 = ModName["data"]["names"]["international"]
		output += "<tr><td>"+place+"</td><td>" + name2 + "</td><td>" + result[key] + "</td><tr>"
	}
	document.getElementById("table").innerHTML = output
	</script>
	<h3 style="color:powderblue;">Credits to https://github.com/AnInternetTroll</h3>
	
</body>

</html>
